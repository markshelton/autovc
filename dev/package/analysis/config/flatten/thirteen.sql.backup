DROP TABLE IF EXISTS companies;
DROP TABLE IF EXISTS companies_plus;
DROP TABLE IF EXISTS acquisitions_plus;
DROP TABLE IF EXISTS funding_rounds_plus;
DROP TABLE IF EXISTS ipos_plus;
DROP TABLE IF EXISTS milestones_plus;
DROP TABLE IF EXISTS offices_plus;
DROP TABLE IF EXISTS investments_plus;
DROP TABLE IF EXISTS investors;
DROP TABLE IF EXISTS investor_invested;
DROP TABLE IF EXISTS investors_plus;
DROP TABLE IF EXISTS people_jobs;
DROP TABLE IF EXISTS people_degrees;
DROP TABLE IF EXISTS people_combo;
DROP TABLE IF EXISTS founders_plus;
DROP TABLE IF EXISTS directors_plus;
DROP TABLE IF EXISTS staff_plus;

DROP TABLE IF EXISTS thirteen;

CREATE TABLE companies
AS
    SELECT *
    FROM objects
    WHERE entity_type = "Company"
;

CREATE TABLE companies_plus
AS
    SELECT
        companies.id as company_id,
        companies.name as keys_company_name,
        companies.permalink as keys_permalink_id,
        companies.category_code as confidence_context_industry_category_main_dummy,
        replace(companies.tag_list,", ",";") as confidence_context_industry_categories_list,
        case when companies.status = "closed" then 1 else 0 end as  confidence_performance_other_closed_bool,
        case when companies.status = "ipo" then 1 else 0 end as  confidence_performance_other_ipo_bool,
        case when companies.status = "operating" then 1 else 0 end as  confidence_performance_other_operating_bool,
        case when companies.status = "acquired" then 1 else 0 end as confidence_performance_other_acquired_bool,
        case when companies.homepage_url != "" then 1 else 0 end as potential_social_influence_website_bool,
        case when companies.twitter_username != "" then 1 else 0 end as potential_social_influence_twitter_bool,
        max(CAST(strftime('%s', companies.founded_at) as INTEGER), 0) as confidence_context_broader_founded_date,
        case when
            companies.closed_at == ""
            then max(CAST(strftime('%s', companies.updated_at) as INTEGER),0)
            else max(CAST(strftime('%s', companies.closed_at) as INTEGER),0)
        end as confidence_performance_other_survival_date,
        companies.country_code as confidence_context_broader_offices_headquarters_country_dummy,
        companies.state_code as confidence_context_local_offices_headquarters_state_dummy,
        companies.region as confidence_context_local_offices_headquarters_region_dummy,
        companies.city as confidence_context_local_offices_headquarters_city_dummy,
        companies.description as confidence_context_industry_description_sentence_text,
        companies.short_description as confidence_context_industry_description_short_text
    FROM companies
;

/*
CREATE TABLE acquisitions_plus
AS
    SELECT
        companies.id as company_acquisitions_id,
        min(max(CAST(strftime('%s', acquisitions.acquired_at) as INTEGER),0)) as acquisitions_first_date,
        max(max(CAST(strftime('%s', acquisitions.acquired_at) as INTEGER),0)) as acquisitions_last_date,
        count(acquisitions.acquired_object_id) as acquisitions_number,
        group_concat(acquisitions.term_code,";") as acquisitions_terms_list, -- CONVERT TO DUMMY VALUES
        sum(case when acquisitions.price_currency_code = "USD" then acquisitions.price_amount else 0 end) as acquisitions_total_value_number
    FROM acquisitions
    LEFT OUTER JOIN companies ON acquisitions.acquiring_object_id = companies.id
    GROUP BY companies.id
;
*/

CREATE TABLE funding_rounds_plus
AS
    SELECT
        companies.id as company_funding_rounds_id,
        min(max(CAST(strftime('%s', funding_rounds.funded_at) as INTEGER),0)) as confidence_validation_funding_first_date,
        max(max(CAST(strftime('%s', funding_rounds.funded_at) as INTEGER),0)) as confidence_validation_funding_last_date,
        count(distinct funding_rounds.funding_round_id) as confidence_validation_funding_rounds_number,
        sum(funding_rounds.raised_amount_usd) as confidence_validation_funding_raised_total_value_number,
        sum(case when funding_rounds.is_last_round = 1 then post_money_valuation_usd else 0 end) as confidence_validation_funding_current_valuation_number,
        sum(funding_rounds.participants) as confidence_validation_funding_investors_participants_total_number,
        group_concat(funding_rounds.funding_round_type,";") as confidence_validation_funding_round_types_list, -- CONVERT TO DUMMY VALUES
        group_concat(funding_rounds.funding_round_code,";") as confidence_validation_funding_round_codes_list, -- CONVERT TO DUMMY VALUES
        ((strftime('%s', max(funding_rounds.funded_at)) - strftime('%s', companies.founded_at)) / count(funding_rounds.funding_round_id)) as confidence_validation_funding_raise_frequency_number,
        (sum(funding_rounds.raised_amount_usd) / count(funding_rounds.funding_round_id)) as confidence_validation_funding_raise_average_number,
        (sum(funding_rounds.raised_amount_usd) / (strftime('%s', max(funding_rounds.funded_at)) - strftime('%s', companies.founded_at))) as confidence_validation_funding_raise_rate_number,
        group_concat(funding_rounds.funding_round_type || ' ' || funding_rounds.raised_amount_usd,";") as confidence_validation_funding_raised_amount_type_number_pair,
        group_concat(funding_rounds.funding_round_type || ' ' || funding_rounds.pre_money_valuation_usd,";") as confidence_validation_funding_pre_money_valuation_type_number_pair,
        group_concat(funding_rounds.funding_round_type || ' ' || funding_rounds.post_money_valuation_usd,";") as confidence_validation_funding_post_money_valuation_type_number_pair,
        group_concat(funding_rounds.funding_round_type || ' ' || funding_rounds.participants,";") as confidence_validation_funding_investors_participants_type_number_pair,
        group_concat(funding_rounds.funding_round_type || ' ' || max(CAST(strftime('%s', funding_rounds.funded_at) as INTEGER),0),";") as confidence_validation_funding_type_date_pair,
        group_concat(funding_rounds.funding_round_code || ' ' || funding_rounds.raised_amount_usd,";") as confidence_validation_funding_raised_amount_code_number_pair,
        group_concat(funding_rounds.funding_round_code || ' ' || funding_rounds.pre_money_valuation_usd,";") as confidence_validation_funding_pre_money_valuation_code_number_pair,
        group_concat(funding_rounds.funding_round_code || ' ' || funding_rounds.post_money_valuation_usd,";") as confidence_validation_funding_post_money_valuation_code_number_pair,
        group_concat(funding_rounds.funding_round_code || ' ' || funding_rounds.participants,";") as confidence_validation_funding_investors_participants_code_number_pair,
        group_concat(funding_rounds.funding_round_code || ' ' || max(CAST(strftime('%s', funding_rounds.funded_at) as INTEGER),0),";") as confidence_validation_funding_code_date_pair
    FROM funding_rounds
    LEFT OUTER JOIN companies ON funding_rounds.object_id = companies.id
    GROUP BY companies.id
;

CREATE TABLE ipos_plus
AS
    SELECT
        companies.id as company_ipos_id,
        (case when ipos.valuation_currency_code = "USD" then ipos.valuation_amount else 0 end) as confidence_performance_financial_ipo_valuation_number,
        (case when ipos.raised_currency_code = "USD" then ipos.raised_amount else 0 end) as confidence_performance_financial_ipo_raise_value_number,
        max(CAST(strftime('%s', ipos.public_at) as INTEGER),0) as confidence_performance_financial_ipo_date
    FROM ipos
    LEFT OUTER JOIN companies ON ipos.object_id = companies.id
    GROUP BY companies.id
;

CREATE TABLE milestones_plus
AS
    SELECT
        companies.id as company_milestones_id,
        min(max(CAST(strftime('%s', milestones.milestone_at) as INTEGER),0)) as confidence_validation_media_milestones_first_date,
        max(max(CAST(strftime('%s', milestones.milestone_at) as INTEGER),0)) as confidence_validation_media_milestones_last_date,
        group_concat(
            case when instr(replace(milestones.source_url, "://","|"),"/") > 0
            then substr(
                replace(milestones.source_url, "://","|"),
                instr(replace(milestones.source_url, "://","|"),"|")+1,
                instr(replace(milestones.source_url, "://","|"),"/") - instr(replace(milestones.source_url, "://","|"),"|")-1)
            else substr(
                replace(milestones.source_url, "://","|"),
                instr(replace(milestones.source_url, "://","|"),"|")+1)
        end,";") as confidence_validation_media_milestones_domain_names_list,
        sum(case when
            (milestones.description LIKE "%ALLIANCE%" or
            milestones.description LIKE "%PARTNER%" or
            milestones.description LIKE "%COLLAB%" or
            milestones.description LIKE "%RESEARCH%" or
            milestones.description LIKE "%UNIVERSITY%" or
            milestones.description LIKE "%COMMERCIALIS%" or
            milestones.description LIKE "%SPIN%" ) and
            milestones.description NOT LIKE "%CAPITAL PARTNERS%" and
            milestones.description NOT LIKE "%VENTURE PARTNERS%" and
            milestones.description NOT LIKE "%EQUITY PARTNERS%" and
            milestones.description NOT LIKE "%MANAGING PARTNER%" and
            milestones.description NOT LIKE "%INVEST%" and
            milestones.description NOT LIKE "%RAISE%" and
            milestones.description NOT LIKE "%ACQUI%"
        then 1 else 0 end) as potential_social_alliances_milestones_count_alliance_number,
        sum(case when milestones.description LIKE "%AWARD%" then 1 else 0 end) as confidence_validation_awards_milestones_count_awards_number,
        sum(case when milestones.description LIKE "%GRANT%" then 1 else 0 end) as confidence_validation_awards_milestones_count_grants_number,
        sum(case when milestones.description LIKE "%GRANT%" OR milestones.description LIKE "%AWARD%"  then 1 else 0 end) as confidence_validation_awards_milestones_count_awards_grants_number,
        count(milestones.object_id) as confidence_validation_media_milestones_count_all_number
    FROM milestones
    LEFT OUTER JOIN companies ON milestones.object_id = companies.id
    GROUP BY companies.id
;

CREATE TABLE offices_plus
AS
    SELECT
        companies.id as company_offices_id,
        count(offices.office_id) as confidence_performance_other_offices_number,
        group_concat(offices.city,";") as confidence_context_local_offices_city_list,--Convert to DUMMY
        group_concat(offices.region,";") as confidence_context_local_offices_region_list,--Convert to DUMMY
        group_concat(offices.state_code,";") as confidence_context_local_offices_state_list,--Convert to DUMMY
        group_concat(offices.country_code,";") as confidence_context_broader_offices_country_list --Convert to DUMMY
    FROM offices
    LEFT OUTER JOIN companies on offices.object_id = companies.id
    GROUP BY companies.id
;

/*
CREATE TABLE investments_plus
AS
    SELECT
        companies.id as company_investments_id,
        min(max(CAST(strftime('%s', funding_rounds.funded_at) as INTEGER),0)) as investments_first_date,
        max(max(CAST(strftime('%s', funding_rounds.funded_at) as INTEGER),0)) as investments_last_date,
        count(funding_rounds.funding_round_id) as investments_number,
        sum(funding_rounds.raised_amount_usd) as investments_total_value_number
    FROM investments
    LEFT OUTER JOIN funding_rounds ON investments.funding_round_id = funding_rounds.funding_round_id
    LEFT OUTER JOIN companies ON investments.investor_object_id = companies.id
    GROUP BY companies.id
;*/

CREATE TABLE investor_invested
AS
    SELECT
	    distinct investments.funded_object_id as investment_id,
	    investments.investor_object_id as investor_id
FROM investments
;

CREATE TABLE investors
AS
    SELECT
	objects.id as object_id,
    objects.name as investor_name,
	count(investments.id) as investors_count_all_investments_number,
	count(distinct investments.funded_object_id) as investors_count_distinct_investments_number,
	count(investments.id) / CAST(count(distinct investments.funded_object_id) as FLOAT)  as investors_average_distinct_investments_number,
	sum(funding_rounds.participants) as investors_funding_coparticipants_total_number,
	avg(funding_rounds.participants) as investors_funding_coparticipants_average_number,
	sum(funding_rounds.raised_amount_usd) as investors_funding_raised_total_number,
	avg(funding_rounds.raised_amount_usd) as investors_funding_raised_average_number,
	sum(case when companies.status = "closed" then 1 else 0 end) as investors_count_funded_closed_total_number,
	sum(case when companies.status = "operating" then 1 else 0 end) as investors_count_funded_operating_total_number,
	sum(case when companies.status = "acquired" then 1 else 0 end) as investors_count_funded_acquired_total_number,
	sum(case when companies.status = "ipo" then 1 else 0 end) as investors_count_funded_ipo_total_number,
	sum(case when companies.status = "acquired" or companies.status = "ipo" then 1 else 0 end) as investors_count_funded_exit_total_number,
	avg(case when companies.status = "closed" then 1 else 0 end) as investors_count_funded_closed_average_number,
	avg(case when companies.status = "operating" then 1 else 0 end) as investors_count_funded_operating_average_number,
	avg(case when companies.status = "acquired" then 1 else 0 end) as investors_count_funded_acquired_average_number,
	avg(case when companies.status = "ipo" then 1 else 0 end) as investors_count_funded_ipo_average_number,
	avg(case when companies.status = "acquired" or companies.status = "ipo" then 1 else 0 end) as investors_count_funded_exit_average_number,
	sum(companies.funding_rounds) as investors_count_funded_rounds_total_number,
	avg(companies.funding_rounds) as investors_count_funded_rounds_average_number,
	sum(companies.funding_total_usd) as investors_sum_funded_raised_total_number,
	avg(companies.funding_total_usd) as investors_sum_funded_raised_average_number
FROM objects
INNER JOIN investments ON objects.id = investments.investor_object_id
LEFT OUTER JOIN funding_rounds ON funding_rounds.funding_round_id = investments.funding_round_id
LEFT OUTER JOIN companies ON companies.id = investments.funded_object_id
GROUP BY objects.id
;

CREATE TABLE investors_plus
AS
    SELECT
        companies.id as company_investors_id,
        sum(investors_count_all_investments_number) as confidence_validation_investors_count_all_investments_sum_number,
        sum(investors_count_distinct_investments_number) as confidence_validation_investors_count_distinct_investments_sum_number,
        sum(investors_average_distinct_investments_number) as confidence_validation_investors_average_distinct_investments_sum_number,
        sum(investors_funding_coparticipants_total_number) as confidence_validation_investors_funding_coparticipants_total_sum_number,
        sum(investors_funding_coparticipants_average_number) as confidence_validation_investors_funding_coparticipants_average_sum_number,
        sum(investors_funding_raised_total_number) as confidence_validation_investors_funding_raised_total_sum_number,
        sum(investors_funding_raised_average_number) as confidence_validation_investors_funding_raised_average_sum_number,
        sum(investors_count_funded_closed_total_number) as confidence_validation_investors_count_funded_closed_total_sum_number,
        sum(investors_count_funded_operating_total_number) as confidence_validation_investors_count_funded_operating_total_sum_number,
        sum(investors_count_funded_acquired_total_number) as confidence_validation_investors_count_funded_acquired_total_sum_number,
        sum(investors_count_funded_ipo_total_number) as confidence_validation_investors_count_funded_ipo_total_sum_number,
        sum(investors_count_funded_exit_total_number) as confidence_validation_investors_count_funded_exit_total_sum_number,
        sum(investors_count_funded_closed_average_number) as confidence_validation_investors_count_funded_closed_average_sum_number,
        sum(investors_count_funded_operating_average_number) as confidence_validation_investors_count_funded_operating_average_sum_number,
        sum(investors_count_funded_acquired_average_number) as confidence_validation_investors_count_funded_acquired_average_sum_number,
        sum(investors_count_funded_ipo_average_number) as confidence_validation_investors_count_funded_ipo_average_sum_number,
        sum(investors_count_funded_exit_average_number) as confidence_validation_investors_count_funded_exit_average_sum_number,
        sum(investors_count_funded_rounds_total_number) as confidence_validation_investors_count_funded_rounds_total_sum_number,
        sum(investors_count_funded_rounds_average_number) as confidence_validation_investors_count_funded_rounds_average_sum_number,
        sum(investors_sum_funded_raised_total_number) as confidence_validation_investors_sum_funded_raised_total_sum_number,
        sum(investors_sum_funded_raised_average_number) as confidence_validation_investors_sum_funded_raised_average_sum_number,
        avg(investors_count_all_investments_number) as confidence_validation_investors_count_all_investments_average_number,
        avg(investors_count_distinct_investments_number) as confidence_validation_investors_count_distinct_investments_average_number,
        avg(investors_average_distinct_investments_number) as confidence_validation_investors_average_distinct_investments_average_number,
        avg(investors_funding_coparticipants_total_number) as confidence_validation_investors_funding_coparticipants_total_average_number,
        avg(investors_funding_coparticipants_average_number) as confidence_validation_investors_funding_coparticipants_average_average_number,
        avg(investors_funding_raised_total_number) as confidence_validation_investors_funding_raised_total_average_number,
        avg(investors_funding_raised_average_number) as confidence_validation_investors_funding_raised_average_average_number,
        avg(investors_count_funded_closed_total_number) as confidence_validation_investors_count_funded_closed_total_average_number,
        avg(investors_count_funded_operating_total_number) as confidence_validation_investors_count_funded_operating_total_average_number,
        avg(investors_count_funded_acquired_total_number) as confidence_validation_investors_count_funded_acquired_total_average_number,
        avg(investors_count_funded_ipo_total_number) as confidence_validation_investors_count_funded_ipo_total_average_number,
        avg(investors_count_funded_exit_total_number) as confidence_validation_investors_count_funded_exit_total_average_number,
        avg(investors_count_funded_closed_average_number) as confidence_validation_investors_count_funded_closed_average_average_number,
        avg(investors_count_funded_operating_average_number) as confidence_validation_investors_count_funded_operating_average_average_number,
        avg(investors_count_funded_acquired_average_number) as confidence_validation_investors_count_funded_acquired_average_average_number,
        avg(investors_count_funded_ipo_average_number) as confidence_validation_investors_count_funded_ipo_average_average_number,
        avg(investors_count_funded_exit_average_number) as confidence_validation_investors_count_funded_exit_average_average_number,
        avg(investors_count_funded_rounds_total_number) as confidence_validation_investors_count_funded_rounds_total_average_number,
        avg(investors_count_funded_rounds_average_number) as confidence_validation_investors_count_funded_rounds_average_average_number,
        avg(investors_sum_funded_raised_total_number) as confidence_validation_investors_sum_funded_raised_total_average_number,
        avg(investors_sum_funded_raised_average_number) as confidence_validation_investors_sum_funded_raised_average_average_number,
        max(investors_count_all_investments_number) as confidence_validation_investors_count_all_investments_max_number,
        max(investors_count_distinct_investments_number) as confidence_validation_investors_count_distinct_investments_max_number,
        max(investors_average_distinct_investments_number) as confidence_validation_investors_average_distinct_investments_max_number,
        max(investors_funding_coparticipants_total_number) as confidence_validation_investors_funding_coparticipants_total_max_number,
        max(investors_funding_coparticipants_average_number) as confidence_validation_investors_funding_coparticipants_average_max_number,
        max(investors_funding_raised_total_number) as confidence_validation_investors_funding_raised_total_max_number,
        max(investors_funding_raised_average_number) as confidence_validation_investors_funding_raised_average_max_number,
        max(investors_count_funded_closed_total_number) as confidence_validation_investors_count_funded_closed_total_max_number,
        max(investors_count_funded_operating_total_number) as confidence_validation_investors_count_funded_operating_total_max_number,
        max(investors_count_funded_acquired_total_number) as confidence_validation_investors_count_funded_acquired_total_max_number,
        max(investors_count_funded_ipo_total_number) as confidence_validation_investors_count_funded_ipo_total_max_number,
        max(investors_count_funded_exit_total_number) as confidence_validation_investors_count_funded_exit_total_max_number,
        max(investors_count_funded_closed_average_number) as confidence_validation_investors_count_funded_closed_average_max_number,
        max(investors_count_funded_operating_average_number) as confidence_validation_investors_count_funded_operating_average_max_number,
        max(investors_count_funded_acquired_average_number) as confidence_validation_investors_count_funded_acquired_average_max_number,
        max(investors_count_funded_ipo_average_number) as confidence_validation_investors_count_funded_ipo_average_max_number,
        max(investors_count_funded_exit_average_number) as confidence_validation_investors_count_funded_exit_average_max_number,
        max(investors_count_funded_rounds_total_number) as confidence_validation_investors_count_funded_rounds_total_max_number,
        max(investors_count_funded_rounds_average_number) as confidence_validation_investors_count_funded_rounds_average_max_number,
        max(investors_sum_funded_raised_total_number) as confidence_validation_investors_sum_funded_raised_total_max_number,
        max(investors_sum_funded_raised_average_number) as confidence_validation_investors_sum_funded_raised_average_max_number
FROM companies
LEFT OUTER JOIN investor_invested ON companies.id = investor_invested.investment_id
LEFT OUTER JOIN investors ON investors.object_id = investor_invested.investor_id
GROUP BY companies.id
;

CREATE TABLE people_jobs
AS
    SELECT
        people.object_id as object_id,
        count(relationships.id) as jobs_all_total_number,
        sum(case when relationships.is_past = 0 then 1 else 0 end) as jobs_current_total_number,
        sum(case when relationships.is_past = 1 then 1 else 0 end) as jobs_past_total_number,
        sum(case when relationships.title LIKE '%found%' then 1 else 0 end) as jobs_founder_total_number,
        sum(case when (relationships.title LIKE '%board%' OR relationships.title LIKE '%director%' OR relationships.title LIKE '%chair%' OR relationships.title LIKE '%partner%') then 1 else 0 end) as jobs_director_total_number,
        sum(strftime('%s', relationships.end_at) - strftime('%s', relationships.start_at)) as jobs_all_total_duration,
        sum(case when relationships.is_past = 0 then (strftime('%s', "2013-12-01") - strftime('%s', relationships.start_at)) else 0 end) as jobs_current_total_duration,
        sum(case when relationships.is_past = 1 then (strftime('%s', "2013-12-01") - strftime('%s', relationships.start_at)) else 0 end) as jobs_past_total_duration,
        sum(case when relationships.title LIKE '%found%' then (strftime('%s', relationships.end_at) - strftime('%s', relationships.start_at)) else 0 end) as jobs_founder_total_duration,
        sum(case when (relationships.title LIKE '%board%' OR relationships.title LIKE '%director%' OR relationships.title LIKE '%chair%' OR relationships.title LIKE '%partner%') then (strftime('%s', relationships.end_at) - strftime('%s', relationships.start_at)) else 0 end) as jobs_director_total_duration,
        sum(relationships.funding_total_usd) as funding_raised_all_total_number,
        sum(case when relationships.is_past = 0 then relationships.funding_total_usd else 0 end) as funding_raised_current_total_number,
        sum(case when relationships.is_past = 1 then relationships.funding_total_usd else 0 end) as funding_raised_past_total_number,
        sum(case when relationships.title LIKE '%found%' then relationships.funding_total_usd else 0 end) as funding_raised_founder_total_number,
        sum(case when (relationships.title LIKE '%board%' OR relationships.title LIKE '%director%' OR relationships.title LIKE '%chair%' OR relationships.title LIKE '%partner%') then relationships.funding_total_usd else 0 end) as funding_raised_director_total_number,
        sum(relationships.funding_rounds) as funding_rounds_all_total_number,
        sum(case when relationships.is_past = 0 then relationships.funding_rounds else 0 end) as funding_rounds_current_total_number,
        sum(case when relationships.is_past = 1 then relationships.funding_rounds else 0 end) as funding_rounds_past_total_number,
        sum(case when relationships.title LIKE '%found%' then relationships.funding_rounds else 0 end) as funding_rounds_founder_total_number,
        sum(case when (relationships.title LIKE '%board%' OR relationships.title LIKE '%director%' OR relationships.title LIKE '%chair%' OR relationships.title LIKE '%partner%') then relationships.funding_rounds else 0 end) as funding_rounds_director_total_number,
        sum(case when relationships.status = "acquired" or relationships.status = "ipo" then 1 else 0 end) as companies_exits_all_total_number,
        sum(case when relationships.status = "acquired" then 1 else 0 end) as companies_acquisitions_all_total_number,
        sum(case when relationships.status = "ipo" then 1 else 0 end) as companies_ipo_all_total_number,
        sum(case when relationships.status = "operating" then 1 else 0 end) as companies_operating_all_total_number,
        sum(case when relationships.status = "closed" then 1 else 0 end) as companies_closed_all_total_number,
        sum(case when relationships.title LIKE '%found%' and (relationships.status = "acquired" or relationships.status = "ipo") then 1 else 0 end) as companies_exits_founder_total_number,
        sum(case when relationships.title LIKE '%found%' and relationships.status = "acquired" then 1 else 0 end) as companies_acquisitions_founder_total_number,
        sum(case when relationships.title LIKE '%found%' and relationships.status = "ipo" then 1 else 0 end) as companies_ipo_founder_total_number,
        sum(case when relationships.title LIKE '%found%' and relationships.status = "operating" then 1 else 0 end) as companies_operating_founder_total_number,
        sum(case when relationships.title LIKE '%found%' and relationships.status = "closed" then 1 else 0 end) as companies_closed_founder_total_number,
        sum(case when (relationships.title LIKE '%board%' OR relationships.title LIKE '%director%' OR relationships.title LIKE '%chair%' OR relationships.title LIKE '%partner%') and (relationships.status = "acquired" or relationships.status = "ipo") then 1 else 0 end) as companies_exits_director_total_number,
        sum(case when (relationships.title LIKE '%board%' OR relationships.title LIKE '%director%' OR relationships.title LIKE '%chair%' OR relationships.title LIKE '%partner%') and relationships.status = "acquired" then 1 else 0 end) as companies_acquisitions_director_total_number,
        sum(case when (relationships.title LIKE '%board%' OR relationships.title LIKE '%director%' OR relationships.title LIKE '%chair%' OR relationships.title LIKE '%partner%') and relationships.status = "ipo" then 1 else 0 end) as companies_ipo_director_total_number,
        sum(case when (relationships.title LIKE '%board%' OR relationships.title LIKE '%director%' OR relationships.title LIKE '%chair%' OR relationships.title LIKE '%partner%') and relationships.status = "operating" then 1 else 0 end) as companies_operating_director_total_number,
        sum(case when (relationships.title LIKE '%board%' OR relationships.title LIKE '%director%' OR relationships.title LIKE '%chair%' OR relationships.title LIKE '%partner%') and relationships.status = "closed" then 1 else 0 end) as companies_closed_director_total_number
    FROM people
    LEFT OUTER JOIN (SELECT * FROM relationships INNER JOIN objects ON relationships.relationship_object_id = objects.id) as relationships
    ON people.object_id = relationships.person_object_id
    GROUP BY people.object_id
;


CREATE TABLE people_degrees
AS
    SELECT *, (people.degrees_count_phd_number + people.degrees_count_masters_number + people.degrees_count_bachelors_number) as degrees_count_all_number
    FROM(
        SELECT
            people.object_id as object_id,
            people.first_name as people_first_name,
            group_concat(degrees.degree_type,";") as degrees_type_list,
            group_concat(degrees.subject,";") as degrees_subject_list,
            group_concat(degrees.institution,";") as degrees_institution_list,
            group_concat(degrees.graduated_at,";") as degrees_graduated_date_list,
            sum(case when (degrees.degree_type LIKE 'Ph%' or degrees.degree_type LIKE '%Doctor%' or degrees.degree_type LIKE 'D.%') and (degrees.degree_type not LIKE '%Medicine%' and degrees.degree_type not LIKE '%Law%' ) then 1 else 0 end) as degrees_count_phd_number,
            sum(case when degrees.degree_type LIKE '%MBA%' then 1 else 0 end) as degrees_count_mba_number,
            sum(case when degrees.degree_type LIKE '%JD%' or degrees.degree_type LIKE 'LL_' or degrees.degree_type LIKE '%Law%'  then 1 else 0 end) as degrees_count_law_number,
            sum(case when degrees.degree_type LIKE '%MD%' or degrees.degree_type LIKE '%MBBS%' or degrees.degree_type LIKE '%Medi%' then 1 else 0 end) as degrees_count_medicine_number,
            sum(case when degrees.degree_type LIKE '%MSE%' or degrees.degree_type LIKE '%MENG%' or degrees.degree_type LIKE '%Engineer%' then 1 else 0 end) as degrees_count_engineering_number,
            sum(case when degrees.degree_type LIKE '%Mast%' or degrees.degree_type LIKE 'M_' or degrees.degree_type LIKE 'M__' or degrees.degree_type LIKE 'M___' or degrees.degree_type LIKE 'M____' or degrees.degree_type LIKE '_M' or degrees.degree_type LIKE '__M' or degrees.degree_type LIKE '%JD%' or degrees.degree_type LIKE '%LLM%' then 1 else 0 end) as degrees_count_masters_number,
            sum(case when degrees.degree_type LIKE '%Bach%' or degrees.degree_type LIKE 'B_' or degrees.degree_type LIKE 'B__'  or degrees.degree_type LIKE 'B___' or degrees.degree_type LIKE 'B____' or degrees.degree_type LIKE '_B' or degrees.degree_type LIKE '__B' or degrees.degree_type LIKE 'Degree'  then 1 else 0 end) as degrees_count_bachelors_number	
        FROM people
        LEFT OUTER JOIN degrees ON people.object_id = degrees.object_id
        GROUP BY people.object_id
    ) as people
;

CREATE TABLE people_combo
AS
    SELECT *
    FROM people_jobs
    NATURAL JOIN people_degrees
;

/*
CREATE TABLE people_plus
AS
    SELECT
        companies.id as company_id,
        count(people_combo.object_id) as people_all_total_number,
        avg(jobs_all_total_number) as people_jobs_all_average_number,
        sum(jobs_all_total_number) as people_jobs_all_total_number,
        avg(jobs_current_total_number) as people_jobs_current_average_number,
        sum(jobs_current_total_number) as people_jobs_current_total_number,
        avg(jobs_past_total_number) as people_jobs_past_average_number,
        sum(jobs_past_total_number) as people_jobs_past_total_number,
        avg(jobs_founder_total_number) as people_jobs_founder_average_number,
        sum(jobs_founder_total_number) as people_jobs_founder_total_number,
        avg(jobs_director_total_number) as people_jobs_director_average_number,
        sum(jobs_director_total_number) as people_jobs_director_total_number,
        avg(jobs_all_total_duration) as people_jobs_all_average_duration,
        sum(jobs_all_total_duration) as people_jobs_all_total_duration,
        avg(jobs_current_total_duration) as people_jobs_current_average_duration,
        sum(jobs_current_total_duration) as people_jobs_current_total_duration,
        avg(jobs_past_total_duration) as people_jobs_past_average_duration,
        sum(jobs_past_total_duration) as people_jobs_past_total_duration,
        avg(jobs_founder_total_duration) as people_jobs_founder_average_duration,
        sum(jobs_founder_total_duration) as people_jobs_founder_total_duration,
        avg(jobs_director_total_duration) as people_jobs_director_average_duration,
        sum(jobs_director_total_duration) as people_jobs_director_total_duration,
        avg(funding_raised_all_total_number) as people_funding_raised_all_average_number,
        sum(funding_raised_all_total_number) as people_funding_raised_all_total_number,
        avg(funding_raised_current_total_number) as people_funding_raised_current_average_number,
        sum(funding_raised_current_total_number) as people_funding_raised_current_total_number,
        avg(funding_raised_past_total_number) as people_funding_raised_past_average_number,
        sum(funding_raised_past_total_number) as people_funding_raised_past_total_number,
        avg(funding_raised_founder_total_number) as people_funding_raised_founder_average_number,
        sum(funding_raised_founder_total_number) as people_funding_raised_founder_total_number,
        avg(funding_raised_director_total_number) as people_funding_raised_director_average_number,
        sum(funding_raised_director_total_number) as people_funding_raised_director_total_number,
        avg(funding_rounds_all_total_number) as people_funding_rounds_all_average_number,
        sum(funding_rounds_all_total_number) as people_funding_rounds_all_total_number,
        avg(funding_rounds_current_total_number) as people_funding_rounds_current_average_number,
        sum(funding_rounds_current_total_number) as people_funding_rounds_current_total_number,
        avg(funding_rounds_past_total_number) as people_funding_rounds_past_average_number,
        sum(funding_rounds_past_total_number) as people_funding_rounds_past_total_number,
        avg(funding_rounds_founder_total_number) as people_funding_rounds_founder_average_number,
        sum(funding_rounds_founder_total_number) as people_funding_rounds_founder_total_number,
        avg(funding_rounds_director_total_number) as people_funding_rounds_director_average_number,
        sum(funding_rounds_director_total_number) as people_funding_rounds_director_total_number,
        avg(companies_exits_all_total_number) as people_companies_exits_all_average_number,
        sum(companies_exits_all_total_number) as people_companies_exits_all_total_number,
        avg(companies_acquisitions_all_total_number) as people_companies_acquisitions_all_average_number,
        sum(companies_acquisitions_all_total_number) as people_companies_acquisitions_all_total_number,
        avg(companies_ipo_all_total_number) as people_companies_ipo_all_average_number,
        sum(companies_ipo_all_total_number) as people_companies_ipo_all_total_number,
        avg(companies_operating_all_total_number) as people_companies_operating_all_average_number,
        sum(companies_operating_all_total_number) as people_companies_operating_all_total_number,
        avg(companies_closed_all_total_number) as people_companies_closed_all_average_number,
        sum(companies_closed_all_total_number) as people_companies_closed_all_total_number,
        avg(companies_exits_founder_total_number) as people_companies_exits_founder_average_number,
        sum(companies_exits_founder_total_number) as people_companies_exits_founder_total_number,
        avg(companies_acquisitions_founder_total_number) as people_companies_acquisitions_founder_average_number,
        sum(companies_acquisitions_founder_total_number) as people_companies_acquisitions_founder_total_number,
        avg(companies_ipo_founder_total_number) as people_companies_ipo_founder_average_number,
        sum(companies_ipo_founder_total_number) as people_companies_ipo_founder_total_number,
        avg(companies_operating_founder_total_number) as people_companies_operating_founder_average_number,
        sum(companies_operating_founder_total_number) as people_companies_operating_founder_total_number,
        avg(companies_closed_founder_total_number) as people_companies_closed_founder_average_number,
        sum(companies_closed_founder_total_number) as people_companies_closed_founder_total_number,
        avg(companies_exits_director_total_number) as people_companies_exits_director_average_number,
        sum(companies_exits_director_total_number) as people_companies_exits_director_total_number,
        avg(companies_acquisitions_director_total_number) as people_companies_acquisitions_director_average_number,
        sum(companies_acquisitions_director_total_number) as people_companies_acquisitions_director_total_number,
        avg(companies_ipo_director_total_number) as people_companies_ipo_director_average_number,
        sum(companies_ipo_director_total_number) as people_companies_ipo_director_total_number,
        avg(companies_operating_director_total_number) as people_companies_operating_director_average_number,
        sum(companies_operating_director_total_number) as people_companies_operating_director_total_number,
        avg(companies_closed_director_total_number) as people_companies_closed_director_average_number,
        sum(companies_closed_director_total_number) as people_companies_closed_director_total_number,
        group_concat(people_first_name,";") as people_people_first_names,
        group_concat(degrees_type_list,";") as people_degrees_type_list,
        group_concat(degrees_subject_list,";") as people_degrees_subject_list,
        group_concat(degrees_institution_list,";") as people_degrees_institution_list,
        avg(degrees_count_phd_number) as people_degrees_count_phd_average_number,
        sum(degrees_count_phd_number) as people_degrees_count_phd_total_number,
        avg(degrees_count_mba_number) as people_degrees_count_mba_average_number,
        sum(degrees_count_mba_number) as people_degrees_count_mba_total_number,
        avg(degrees_count_law_number) as people_degrees_count_law_average_number,
        sum(degrees_count_law_number) as people_degrees_count_law_total_number,
        avg(degrees_count_medicine_number) as people_degrees_count_medicine_average_number,
        sum(degrees_count_medicine_number) as people_degrees_count_medicine_total_number,
        avg(degrees_count_engineering_number) as people_degrees_count_engineering_average_number,
        sum(degrees_count_engineering_number) as people_degrees_count_engineering_total_number,
        avg(degrees_count_masters_number) as people_degrees_count_masters_average_number,
        sum(degrees_count_masters_number) as people_degrees_count_masters_total_number,
        avg(degrees_count_bachelors_number) as people_degrees_count_bachelors_average_number,
        sum(degrees_count_bachelors_number) as people_degrees_count_bachelors_total_number
    FROM people_combo
    LEFT OUTER JOIN relationships on people_combo.object_id = relationships.person_object_id
    LEFT OUTER JOIN companies on relationships.relationship_object_id = companies.id
    GROUP BY companies.id
;
*/

CREATE TABLE founders_plus
AS
    SELECT
        companies.id as company_id,
        count(people_combo.object_id) as potential_human_founders_all_total_number,
        avg(jobs_all_total_number) as potential_human_founders_jobs_all_average_number,
        sum(jobs_all_total_number) as potential_human_founders_jobs_all_total_number,
        avg(jobs_current_total_number) as potential_human_founders_jobs_current_average_number,
        sum(jobs_current_total_number) as potential_human_founders_jobs_current_total_number,
        avg(jobs_past_total_number) as potential_human_founders_jobs_past_average_number,
        sum(jobs_past_total_number) as potential_human_founders_jobs_past_total_number,
        avg(jobs_founder_total_number) as potential_human_founders_jobs_founder_average_number,
        sum(jobs_founder_total_number) as potential_human_founders_jobs_founder_total_number,
        avg(jobs_director_total_number) as potential_human_founders_jobs_director_average_number,
        sum(jobs_director_total_number) as potential_human_founders_jobs_director_total_number,
        avg(jobs_all_total_duration) as potential_human_founders_jobs_all_average_duration,
        sum(jobs_all_total_duration) as potential_human_founders_jobs_all_total_duration,
        avg(jobs_current_total_duration) as potential_human_founders_jobs_current_average_duration,
        sum(jobs_current_total_duration) as potential_human_founders_jobs_current_total_duration,
        avg(jobs_past_total_duration) as potential_human_founders_jobs_past_average_duration,
        sum(jobs_past_total_duration) as potential_human_founders_jobs_past_total_duration,
        avg(jobs_founder_total_duration) as potential_human_founders_jobs_founder_average_duration,
        sum(jobs_founder_total_duration) as potential_human_founders_jobs_founder_total_duration,
        avg(jobs_director_total_duration) as potential_human_founders_jobs_director_average_duration,
        sum(jobs_director_total_duration) as potential_human_founders_jobs_director_total_duration,
        avg(funding_raised_all_total_number) as potential_human_founders_funding_raised_all_average_number,
        sum(funding_raised_all_total_number) as potential_human_founders_funding_raised_all_total_number,
        avg(funding_raised_current_total_number) as potential_human_founders_funding_raised_current_average_number,
        sum(funding_raised_current_total_number) as potential_human_founders_funding_raised_current_total_number,
        avg(funding_raised_past_total_number) as potential_human_founders_funding_raised_past_average_number,
        sum(funding_raised_past_total_number) as potential_human_founders_funding_raised_past_total_number,
        avg(funding_raised_founder_total_number) as potential_human_founders_funding_raised_founder_average_number,
        sum(funding_raised_founder_total_number) as potential_human_founders_funding_raised_founder_total_number,
        avg(funding_raised_director_total_number) as potential_human_founders_funding_raised_director_average_number,
        sum(funding_raised_director_total_number) as potential_human_founders_funding_raised_director_total_number,
        avg(funding_rounds_all_total_number) as potential_human_founders_funding_rounds_all_average_number,
        sum(funding_rounds_all_total_number) as potential_human_founders_funding_rounds_all_total_number,
        avg(funding_rounds_current_total_number) as potential_human_founders_funding_rounds_current_average_number,
        sum(funding_rounds_current_total_number) as potential_human_founders_funding_rounds_current_total_number,
        avg(funding_rounds_past_total_number) as potential_human_founders_funding_rounds_past_average_number,
        sum(funding_rounds_past_total_number) as potential_human_founders_funding_rounds_past_total_number,
        avg(funding_rounds_founder_total_number) as potential_human_founders_funding_rounds_founder_average_number,
        sum(funding_rounds_founder_total_number) as potential_human_founders_funding_rounds_founder_total_number,
        avg(funding_rounds_director_total_number) as potential_human_founders_funding_rounds_director_average_number,
        sum(funding_rounds_director_total_number) as potential_human_founders_funding_rounds_director_total_number,
        avg(companies_exits_all_total_number) as potential_human_founders_companies_exits_all_average_number,
        sum(companies_exits_all_total_number) as potential_human_founders_companies_exits_all_total_number,
        avg(companies_acquisitions_all_total_number) as potential_human_founders_companies_acquisitions_all_average_number,
        sum(companies_acquisitions_all_total_number) as potential_human_founders_companies_acquisitions_all_total_number,
        avg(companies_ipo_all_total_number) as potential_human_founders_companies_ipo_all_average_number,
        sum(companies_ipo_all_total_number) as potential_human_founders_companies_ipo_all_total_number,
        avg(companies_operating_all_total_number) as potential_human_founders_companies_operating_all_average_number,
        sum(companies_operating_all_total_number) as potential_human_founders_companies_operating_all_total_number,
        avg(companies_closed_all_total_number) as potential_human_founders_companies_closed_all_average_number,
        sum(companies_closed_all_total_number) as potential_human_founders_companies_closed_all_total_number,
        avg(companies_exits_founder_total_number) as potential_human_founders_companies_exits_founder_average_number,
        sum(companies_exits_founder_total_number) as potential_human_founders_companies_exits_founder_total_number,
        avg(companies_acquisitions_founder_total_number) as potential_human_founders_companies_acquisitions_founder_average_number,
        sum(companies_acquisitions_founder_total_number) as potential_human_founders_companies_acquisitions_founder_total_number,
        avg(companies_ipo_founder_total_number) as potential_human_founders_companies_ipo_founder_average_number,
        sum(companies_ipo_founder_total_number) as potential_human_founders_companies_ipo_founder_total_number,
        avg(companies_operating_founder_total_number) as potential_human_founders_companies_operating_founder_average_number,
        sum(companies_operating_founder_total_number) as potential_human_founders_companies_operating_founder_total_number,
        avg(companies_closed_founder_total_number) as potential_human_founders_companies_closed_founder_average_number,
        sum(companies_closed_founder_total_number) as potential_human_founders_companies_closed_founder_total_number,
        avg(companies_exits_director_total_number) as potential_human_founders_companies_exits_director_average_number,
        sum(companies_exits_director_total_number) as potential_human_founders_companies_exits_director_total_number,
        avg(companies_acquisitions_director_total_number) as potential_human_founders_companies_acquisitions_director_average_number,
        sum(companies_acquisitions_director_total_number) as potential_human_founders_companies_acquisitions_director_total_number,
        avg(companies_ipo_director_total_number) as potential_human_founders_companies_ipo_director_average_number,
        sum(companies_ipo_director_total_number) as potential_human_founders_companies_ipo_director_total_number,
        avg(companies_operating_director_total_number) as potential_human_founders_companies_operating_director_average_number,
        sum(companies_operating_director_total_number) as potential_human_founders_companies_operating_director_total_number,
        avg(companies_closed_director_total_number) as potential_human_founders_companies_closed_director_average_number,
        sum(companies_closed_director_total_number) as potential_human_founders_companies_closed_director_total_number,
        --group_concat(people_first_name,";") as potential_human_founders_first_names,
        --group_concat(degrees_type_list,";") as potential_human_founders_degrees_type_list,
        --group_concat(degrees_subject_list,";") as potential_human_founders_degrees_subject_list,
        group_concat(degrees_institution_list,";") as potential_human_founders_degrees_institution_list,
        avg(degrees_count_phd_number) as potential_human_founders_degrees_count_phd_average_number,
        sum(degrees_count_phd_number) as potential_human_founders_degrees_count_phd_total_number,
        avg(degrees_count_mba_number) as potential_human_founders_degrees_count_mba_average_number,
        sum(degrees_count_mba_number) as potential_human_founders_degrees_count_mba_total_number,
        avg(degrees_count_law_number) as potential_human_founders_degrees_count_law_average_number,
        sum(degrees_count_law_number) as potential_human_founders_degrees_count_law_total_number,
        avg(degrees_count_medicine_number) as potential_human_founders_degrees_count_medicine_average_number,
        sum(degrees_count_medicine_number) as potential_human_founders_degrees_count_medicine_total_number,
        avg(degrees_count_engineering_number) as potential_human_founders_degrees_count_engineering_average_number,
        sum(degrees_count_engineering_number) as potential_human_founders_degrees_count_engineering_total_number,
        avg(degrees_count_masters_number) as potential_human_founders_degrees_count_masters_average_number,
        sum(degrees_count_masters_number) as potential_human_founders_degrees_count_masters_total_number,
        avg(degrees_count_bachelors_number) as potential_human_founders_degrees_count_bachelors_average_number,
        sum(degrees_count_bachelors_number) as potential_human_founders_degrees_count_bachelors_total_number
    FROM people_combo
    LEFT OUTER JOIN relationships on people_combo.object_id = relationships.person_object_id
    LEFT OUTER JOIN companies on relationships.relationship_object_id = companies.id
    WHERE relationships.title LIKE '%found%'
    GROUP BY companies.id
;

CREATE TABLE directors_plus
AS
    SELECT
        companies.id as company_id,
        count(people_combo.object_id) as potential_human_directors_all_total_number,
        avg(jobs_all_total_number) as potential_human_directors_jobs_all_average_number,
        sum(jobs_all_total_number) as potential_human_directors_jobs_all_total_number,
        avg(jobs_current_total_number) as potential_human_directors_jobs_current_average_number,
        sum(jobs_current_total_number) as potential_human_directors_jobs_current_total_number,
        avg(jobs_past_total_number) as potential_human_directors_jobs_past_average_number,
        sum(jobs_past_total_number) as potential_human_directors_jobs_past_total_number,
        avg(jobs_founder_total_number) as potential_human_directors_jobs_founder_average_number,
        sum(jobs_founder_total_number) as potential_human_directors_jobs_founder_total_number,
        avg(jobs_director_total_number) as potential_human_directors_jobs_director_average_number,
        sum(jobs_director_total_number) as potential_human_directors_jobs_director_total_number,
        avg(jobs_all_total_duration) as potential_human_directors_jobs_all_average_duration,
        sum(jobs_all_total_duration) as potential_human_directors_jobs_all_total_duration,
        avg(jobs_current_total_duration) as potential_human_directors_jobs_current_average_duration,
        sum(jobs_current_total_duration) as potential_human_directors_jobs_current_total_duration,
        avg(jobs_past_total_duration) as potential_human_directors_jobs_past_average_duration,
        sum(jobs_past_total_duration) as potential_human_directors_jobs_past_total_duration,
        avg(jobs_founder_total_duration) as potential_human_directors_jobs_founder_average_duration,
        sum(jobs_founder_total_duration) as potential_human_directors_jobs_founder_total_duration,
        avg(jobs_director_total_duration) as potential_human_directors_jobs_director_average_duration,
        sum(jobs_director_total_duration) as potential_human_directors_jobs_director_total_duration,
        avg(funding_raised_all_total_number) as potential_human_directors_funding_raised_all_average_number,
        sum(funding_raised_all_total_number) as potential_human_directors_funding_raised_all_total_number,
        avg(funding_raised_current_total_number) as potential_human_directors_funding_raised_current_average_number,
        sum(funding_raised_current_total_number) as potential_human_directors_funding_raised_current_total_number,
        avg(funding_raised_past_total_number) as potential_human_directors_funding_raised_past_average_number,
        sum(funding_raised_past_total_number) as potential_human_directors_funding_raised_past_total_number,
        avg(funding_raised_founder_total_number) as potential_human_directors_funding_raised_founder_average_number,
        sum(funding_raised_founder_total_number) as potential_human_directors_funding_raised_founder_total_number,
        avg(funding_raised_director_total_number) as potential_human_directors_funding_raised_director_average_number,
        sum(funding_raised_director_total_number) as potential_human_directors_funding_raised_director_total_number,
        avg(funding_rounds_all_total_number) as potential_human_directors_funding_rounds_all_average_number,
        sum(funding_rounds_all_total_number) as potential_human_directors_funding_rounds_all_total_number,
        avg(funding_rounds_current_total_number) as potential_human_directors_funding_rounds_current_average_number,
        sum(funding_rounds_current_total_number) as potential_human_directors_funding_rounds_current_total_number,
        avg(funding_rounds_past_total_number) as potential_human_directors_funding_rounds_past_average_number,
        sum(funding_rounds_past_total_number) as potential_human_directors_funding_rounds_past_total_number,
        avg(funding_rounds_founder_total_number) as potential_human_directors_funding_rounds_founder_average_number,
        sum(funding_rounds_founder_total_number) as potential_human_directors_funding_rounds_founder_total_number,
        avg(funding_rounds_director_total_number) as potential_human_directors_funding_rounds_director_average_number,
        sum(funding_rounds_director_total_number) as potential_human_directors_funding_rounds_director_total_number,
        avg(companies_exits_all_total_number) as potential_human_directors_companies_exits_all_average_number,
        sum(companies_exits_all_total_number) as potential_human_directors_companies_exits_all_total_number,
        avg(companies_acquisitions_all_total_number) as potential_human_directors_companies_acquisitions_all_average_number,
        sum(companies_acquisitions_all_total_number) as potential_human_directors_companies_acquisitions_all_total_number,
        avg(companies_ipo_all_total_number) as potential_human_directors_companies_ipo_all_average_number,
        sum(companies_ipo_all_total_number) as potential_human_directors_companies_ipo_all_total_number,
        avg(companies_operating_all_total_number) as potential_human_directors_companies_operating_all_average_number,
        sum(companies_operating_all_total_number) as potential_human_directors_companies_operating_all_total_number,
        avg(companies_closed_all_total_number) as potential_human_directors_companies_closed_all_average_number,
        sum(companies_closed_all_total_number) as potential_human_directors_companies_closed_all_total_number,
        avg(companies_exits_founder_total_number) as potential_human_directors_companies_exits_founder_average_number,
        sum(companies_exits_founder_total_number) as potential_human_directors_companies_exits_founder_total_number,
        avg(companies_acquisitions_founder_total_number) as potential_human_directors_companies_acquisitions_founder_average_number,
        sum(companies_acquisitions_founder_total_number) as potential_human_directors_companies_acquisitions_founder_total_number,
        avg(companies_ipo_founder_total_number) as potential_human_directors_companies_ipo_founder_average_number,
        sum(companies_ipo_founder_total_number) as potential_human_directors_companies_ipo_founder_total_number,
        avg(companies_operating_founder_total_number) as potential_human_directors_companies_operating_founder_average_number,
        sum(companies_operating_founder_total_number) as potential_human_directors_companies_operating_founder_total_number,
        avg(companies_closed_founder_total_number) as potential_human_directors_companies_closed_founder_average_number,
        sum(companies_closed_founder_total_number) as potential_human_directors_companies_closed_founder_total_number,
        avg(companies_exits_director_total_number) as potential_human_directors_companies_exits_director_average_number,
        sum(companies_exits_director_total_number) as potential_human_directors_companies_exits_director_total_number,
        avg(companies_acquisitions_director_total_number) as potential_human_directors_companies_acquisitions_director_average_number,
        sum(companies_acquisitions_director_total_number) as potential_human_directors_companies_acquisitions_director_total_number,
        avg(companies_ipo_director_total_number) as potential_human_directors_companies_ipo_director_average_number,
        sum(companies_ipo_director_total_number) as potential_human_directors_companies_ipo_director_total_number,
        avg(companies_operating_director_total_number) as potential_human_directors_companies_operating_director_average_number,
        sum(companies_operating_director_total_number) as potential_human_directors_companies_operating_director_total_number,
        avg(companies_closed_director_total_number) as potential_human_directors_companies_closed_director_average_number,
        sum(companies_closed_director_total_number) as potential_human_directors_companies_closed_director_total_number,
        --group_concat(people_first_name,";") as potential_human_directors_first_names,
        --group_concat(degrees_type_list,";") as potential_human_directors_degrees_type_list,
        --group_concat(degrees_subject_list,";") as potential_human_directors_degrees_subject_list,
        group_concat(degrees_institution_list,";") as potential_human_directors_degrees_institution_list,
        avg(degrees_count_phd_number) as potential_human_directors_degrees_count_phd_average_number,
        sum(degrees_count_phd_number) as potential_human_directors_degrees_count_phd_total_number,
        avg(degrees_count_mba_number) as potential_human_directors_degrees_count_mba_average_number,
        sum(degrees_count_mba_number) as potential_human_directors_degrees_count_mba_total_number,
        avg(degrees_count_law_number) as potential_human_directors_degrees_count_law_average_number,
        sum(degrees_count_law_number) as potential_human_directors_degrees_count_law_total_number,
        avg(degrees_count_medicine_number) as potential_human_directors_degrees_count_medicine_average_number,
        sum(degrees_count_medicine_number) as potential_human_directors_degrees_count_medicine_total_number,
        avg(degrees_count_engineering_number) as potential_human_directors_degrees_count_engineering_average_number,
        sum(degrees_count_engineering_number) as potential_human_directors_degrees_count_engineering_total_number,
        avg(degrees_count_masters_number) as potential_human_directors_degrees_count_masters_average_number,
        sum(degrees_count_masters_number) as potential_human_directors_degrees_count_masters_total_number,
        avg(degrees_count_bachelors_number) as potential_human_directors_degrees_count_bachelors_average_number,
        sum(degrees_count_bachelors_number) as potential_human_directors_degrees_count_bachelors_total_number
    FROM people_combo
    LEFT OUTER JOIN relationships on people_combo.object_id = relationships.person_object_id
    LEFT OUTER JOIN companies on relationships.relationship_object_id = companies.id
    WHERE relationships.title LIKE '%board%' OR relationships.title LIKE '%director%' OR relationships.title LIKE '%chair%' OR relationships.title LIKE '%partner%'
    GROUP BY companies.id
;

CREATE TABLE staff_plus
AS
    SELECT
        companies.id as company_id,
        count(people_combo.object_id) as confidence_performance_other_staff_all_total_number,
        avg(jobs_all_total_number) as potential_human_staff_jobs_all_average_number,
        sum(jobs_all_total_number) as potential_human_staff_jobs_all_total_number,
        avg(jobs_current_total_number) as potential_human_staff_jobs_current_average_number,
        sum(jobs_current_total_number) as potential_human_staff_jobs_current_total_number,
        avg(jobs_past_total_number) as potential_human_staff_jobs_past_average_number,
        sum(jobs_past_total_number) as potential_human_staff_jobs_past_total_number,
        avg(jobs_founder_total_number) as potential_human_staff_jobs_founder_average_number,
        sum(jobs_founder_total_number) as potential_human_staff_jobs_founder_total_number,
        avg(jobs_director_total_number) as potential_human_staff_jobs_director_average_number,
        sum(jobs_director_total_number) as potential_human_staff_jobs_director_total_number,
        avg(jobs_all_total_duration) as potential_human_staff_jobs_all_average_duration,
        sum(jobs_all_total_duration) as potential_human_staff_jobs_all_total_duration,
        avg(jobs_current_total_duration) as potential_human_staff_jobs_current_average_duration,
        sum(jobs_current_total_duration) as potential_human_staff_jobs_current_total_duration,
        avg(jobs_past_total_duration) as potential_human_staff_jobs_past_average_duration,
        sum(jobs_past_total_duration) as potential_human_staff_jobs_past_total_duration,
        avg(jobs_founder_total_duration) as potential_human_staff_jobs_founder_average_duration,
        sum(jobs_founder_total_duration) as potential_human_staff_jobs_founder_total_duration,
        avg(jobs_director_total_duration) as potential_human_staff_jobs_director_average_duration,
        sum(jobs_director_total_duration) as potential_human_staff_jobs_director_total_duration,
        avg(funding_raised_all_total_number) as potential_human_staff_funding_raised_all_average_number,
        sum(funding_raised_all_total_number) as potential_human_staff_funding_raised_all_total_number,
        avg(funding_raised_current_total_number) as potential_human_staff_funding_raised_current_average_number,
        sum(funding_raised_current_total_number) as potential_human_staff_funding_raised_current_total_number,
        avg(funding_raised_past_total_number) as potential_human_staff_funding_raised_past_average_number,
        sum(funding_raised_past_total_number) as potential_human_staff_funding_raised_past_total_number,
        avg(funding_raised_founder_total_number) as potential_human_staff_funding_raised_founder_average_number,
        sum(funding_raised_founder_total_number) as potential_human_staff_funding_raised_founder_total_number,
        avg(funding_raised_director_total_number) as potential_human_staff_funding_raised_director_average_number,
        sum(funding_raised_director_total_number) as potential_human_staff_funding_raised_director_total_number,
        avg(funding_rounds_all_total_number) as potential_human_staff_funding_rounds_all_average_number,
        sum(funding_rounds_all_total_number) as potential_human_staff_funding_rounds_all_total_number,
        avg(funding_rounds_current_total_number) as potential_human_staff_funding_rounds_current_average_number,
        sum(funding_rounds_current_total_number) as potential_human_staff_funding_rounds_current_total_number,
        avg(funding_rounds_past_total_number) as potential_human_staff_funding_rounds_past_average_number,
        sum(funding_rounds_past_total_number) as potential_human_staff_funding_rounds_past_total_number,
        avg(funding_rounds_founder_total_number) as potential_human_staff_funding_rounds_founder_average_number,
        sum(funding_rounds_founder_total_number) as potential_human_staff_funding_rounds_founder_total_number,
        avg(funding_rounds_director_total_number) as potential_human_staff_funding_rounds_director_average_number,
        sum(funding_rounds_director_total_number) as potential_human_staff_funding_rounds_director_total_number,
        avg(companies_exits_all_total_number) as potential_human_staff_companies_exits_all_average_number,
        sum(companies_exits_all_total_number) as potential_human_staff_companies_exits_all_total_number,
        avg(companies_acquisitions_all_total_number) as potential_human_staff_companies_acquisitions_all_average_number,
        sum(companies_acquisitions_all_total_number) as potential_human_staff_companies_acquisitions_all_total_number,
        avg(companies_ipo_all_total_number) as potential_human_staff_companies_ipo_all_average_number,
        sum(companies_ipo_all_total_number) as potential_human_staff_companies_ipo_all_total_number,
        avg(companies_operating_all_total_number) as potential_human_staff_companies_operating_all_average_number,
        sum(companies_operating_all_total_number) as potential_human_staff_companies_operating_all_total_number,
        avg(companies_closed_all_total_number) as potential_human_staff_companies_closed_all_average_number,
        sum(companies_closed_all_total_number) as potential_human_staff_companies_closed_all_total_number,
        avg(companies_exits_founder_total_number) as potential_human_staff_companies_exits_founder_average_number,
        sum(companies_exits_founder_total_number) as potential_human_staff_companies_exits_founder_total_number,
        avg(companies_acquisitions_founder_total_number) as potential_human_staff_companies_acquisitions_founder_average_number,
        sum(companies_acquisitions_founder_total_number) as potential_human_staff_companies_acquisitions_founder_total_number,
        avg(companies_ipo_founder_total_number) as potential_human_staff_companies_ipo_founder_average_number,
        sum(companies_ipo_founder_total_number) as potential_human_staff_companies_ipo_founder_total_number,
        avg(companies_operating_founder_total_number) as potential_human_staff_companies_operating_founder_average_number,
        sum(companies_operating_founder_total_number) as potential_human_staff_companies_operating_founder_total_number,
        avg(companies_closed_founder_total_number) as potential_human_staff_companies_closed_founder_average_number,
        sum(companies_closed_founder_total_number) as potential_human_staff_companies_closed_founder_total_number,
        avg(companies_exits_director_total_number) as potential_human_staff_companies_exits_director_average_number,
        sum(companies_exits_director_total_number) as potential_human_staff_companies_exits_director_total_number,
        avg(companies_acquisitions_director_total_number) as potential_human_staff_companies_acquisitions_director_average_number,
        sum(companies_acquisitions_director_total_number) as potential_human_staff_companies_acquisitions_director_total_number,
        avg(companies_ipo_director_total_number) as potential_human_staff_companies_ipo_director_average_number,
        sum(companies_ipo_director_total_number) as potential_human_staff_companies_ipo_director_total_number,
        avg(companies_operating_director_total_number) as potential_human_staff_companies_operating_director_average_number,
        sum(companies_operating_director_total_number) as potential_human_staff_companies_operating_director_total_number,
        avg(companies_closed_director_total_number) as potential_human_staff_companies_closed_director_average_number,
        sum(companies_closed_director_total_number) as potential_human_staff_companies_closed_director_total_number,
        --group_concat(people_first_name,";") as potential_human_staff_first_names,
        --group_concat(degrees_type_list,";") as potential_human_staff_degrees_type_list,
        --group_concat(degrees_subject_list,";") as potential_human_staff_degrees_subject_list,
        group_concat(degrees_institution_list,";") as potential_human_staff_degrees_institution_list,
        avg(degrees_count_phd_number) as potential_human_staff_degrees_count_phd_average_number,
        sum(degrees_count_phd_number) as potential_human_staff_degrees_count_phd_total_number,
        avg(degrees_count_mba_number) as potential_human_staff_degrees_count_mba_average_number,
        sum(degrees_count_mba_number) as potential_human_staff_degrees_count_mba_total_number,
        avg(degrees_count_law_number) as potential_human_staff_degrees_count_law_average_number,
        sum(degrees_count_law_number) as potential_human_staff_degrees_count_law_total_number,
        avg(degrees_count_medicine_number) as potential_human_staff_degrees_count_medicine_average_number,
        sum(degrees_count_medicine_number) as potential_human_staff_degrees_count_medicine_total_number,
        avg(degrees_count_engineering_number) as potential_human_staff_degrees_count_engineering_average_number,
        sum(degrees_count_engineering_number) as potential_human_staff_degrees_count_engineering_total_number,
        avg(degrees_count_masters_number) as potential_human_staff_degrees_count_masters_average_number,
        sum(degrees_count_masters_number) as potential_human_staff_degrees_count_masters_total_number,
        avg(degrees_count_bachelors_number) as potential_human_staff_degrees_count_bachelors_average_number,
        sum(degrees_count_bachelors_number) as potential_human_staff_degrees_count_bachelors_total_number
    FROM people_combo
    LEFT OUTER JOIN relationships on people_combo.object_id = relationships.person_object_id
    LEFT OUTER JOIN companies on relationships.relationship_object_id = companies.id
    WHERE relationships.title NOT LIKE '%found%' AND relationships.title NOT LIKE '%board%' AND relationships.title NOT LIKE '%director%' AND relationships.title NOT LIKE '%chair%' AND relationships.title NOT LIKE '%partner%'
    GROUP BY companies.id
;

CREATE TABLE thirteen
AS
    SELECT *
    FROM companies_plus
    --LEFT OUTER JOIN acquisitions_plus ON companies_plus.company_id = acquisitions_plus.company_acquisitions_id
    --LEFT OUTER JOIN investments_plus ON companies_plus.company_id = investments_plus.company_investments_id
    LEFT OUTER JOIN investors_plus ON companies_plus.company_id = investors_plus.company_investors_id
    LEFT OUTER JOIN funding_rounds_plus ON companies_plus.company_id = funding_rounds_plus.company_funding_rounds_id
    LEFT OUTER JOIN ipos_plus ON companies_plus.company_id = ipos_plus.company_ipos_id
    LEFT OUTER JOIN milestones_plus ON companies_plus.company_id = milestones_plus.company_milestones_id
    LEFT OUTER JOIN offices_plus ON companies_plus.company_id = offices_plus.company_offices_id
    LEFT OUTER JOIN founders_plus ON companies_plus.company_id = founders_plus.company_id
    LEFT OUTER JOIN directors_plus ON companies_plus.company_id = directors_plus.company_id
    LEFT OUTER JOIN staff_plus ON companies_plus.company_id = staff_plus.company_id
    GROUP BY companies_plus.company_id
;

--DROP TABLE IF EXISTS companies;
DROP TABLE IF EXISTS companies_plus;
DROP TABLE IF EXISTS acquisitions_plus;
DROP TABLE IF EXISTS funding_rounds_plus;
DROP TABLE IF EXISTS ipos_plus;
DROP TABLE IF EXISTS milestones_plus;
DROP TABLE IF EXISTS offices_plus;
DROP TABLE IF EXISTS investments_plus;
--DROP TABLE IF EXISTS people_jobs;
--DROP TABLE IF EXISTS people_degrees;
--DROP TABLE IF EXISTS people_combo;
--DROP TABLE IF EXISTS founders_plus;
--DROP TABLE IF EXISTS directors_plus;
--DROP TABLE IF EXISTS staff_plus;